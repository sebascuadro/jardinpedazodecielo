!function(r){r.cuar||(r.cuar={}),r.cuar.conversationManager=function(e,t){var o=this;o.$el=r(e),o.el=e,o.$el.data("cuar.conversationManager",o),o.richEditorType=null,o.init=function(){o.options=r.extend({},r.cuar.conversationManager.defaultOptions,t);var e=o._getReplyList();o._getErrorList().on("click",".cuar-js-dismiss",o._onDismissError),o._detectRichEditorType(),o._isTinyMceEnabled()?tinymce.on("AddEditor",function(e){tinymce.get(o.options.tinyMceEditor).on("keyup",function(e,t){o._onAddReplyContentChanged(o._getAddReplyContent())})}):o._isSummerNoteEnabled()?r(o.options.replyContentContainer,o.el).find(".cuar-js-richeditor").on("summernote.change",function(e,t,n){o._onAddReplyContentChanged(t)}):r(o.options.replyContentContainer,o.el).find("textarea").keyup(function(e){o._onAddReplyContentChanged(o._getAddReplyContent())}),o.$el.on("click",o.options.addButton,o._addReply),e.on("click",o.options.deleteButton,o._deleteReply)},o._detectRichEditorType=function(){0<r(o.options.replyContentContainer,o.el).find(".tmce-active").length?o.richEditorType="tinymce":r(o.options.replyContentContainer,o.el).find("textarea").hasClass("cuar-js-richeditor")?o.richEditorType="summernote":o.richEditorType=null},o._onAddReplyContentChanged=function(e){o._updateAddReplyButtonState(e)},o._updateAddReplyButtonState=function(e){o._canAddReply(e)?o._getAddReplyButton().removeAttr("disabled"):o._getAddReplyButton().attr("disabled","disabled")},o._canAddReply=function(e){return 0<e.length},o._addReply=function(e){e.preventDefault(),o._getShownWhenLoading().slideDown(),o._disableAddForm();var t={action:"cuar_add_reply",cuar_add_reply_nonce:o._getAddReplyNonce(),cuar_conversation_id:o._getConversationId(),cuar_reply_content:o._getAddReplyContent()};r.post(cuar.ajaxUrl,t,function(e){o._getShownWhenLoading().slideUp(),o._enableAddForm(),0!=e.success?(o._showError(null),o._resetAddReplyForm(),o._getEmptyMessage().hide(),o._onReplyAdded(e.data)):o._showError(e.data)})},o._onReplyAdded=function(e){var t=o._getReplyTemplate().clone(),n=o.options.replyTemplateItem;"."==n.charAt(0)&&(n=n.substr(1)),t.removeClass(n),t.attr("id","cuar_reply_"+e.reply_id),t.attr("style",""),t.data("reply-id",e.reply_id),t.find(o.options.replyContent).html(e.reply_content),t.find(o.options.replyTimestamp).html(e.reply_date+" - "+e.reply_time),t.find(o.options.replyAuthorName).html(e.author_name),t.find(o.options.replyAvatarUrl).attr("src",e.author_avatar_url),o.options.userIsConversationAuthor?t.find(o.options.hideWhenAuthor).remove():t.find(o.options.showWhenAuthor).remove(),e.user_can_delete||t.find(o.options.deleteButton).remove(),t.appendTo(o._getReplyList())},o._disableAddForm=function(){o._getAddReplyForm().animate({opacity:.5}),o._getAddReplyButton().attr("disabled","disabled")},o._enableAddForm=function(){o._getAddReplyForm().animate({opacity:1}),o._getAddReplyButton().removeAttr("disabled")},o._showError=function(e){null!=e&&0<e.length?o._getErrorList().show().find(o.options.errorItemContent).html(e):o._getErrorList().hide()},o._resetAddReplyForm=function(){if(o._isTinyMceEnabled()){var e=tinyMCE.get(o.options.tinyMceEditor);e.setContent(""),e.focus()}else if(o._isSummerNoteEnabled()){(t=r(o.options.replyContentContainer,o.el).find(".cuar-js-richeditor")).summernote("code",""),t.summernote("focus")}else{var t;(t=r(o.options.replyContentContainer,o.el).find("textarea")).val("").focus()}r(o.options.addButton,o.el).attr("disabled","disabled")},o._deleteReply=function(e){if(e.preventDefault(),confirm(cuar.deleteReplyConfirmMessage)){var t=o._getReplyFromAction(r(this));o._disableReplyItem(t);var n={action:"cuar_delete_reply",cuar_delete_reply_nonce:o._getDeleteReplyNonce(),cuar_conversation_id:o._getConversationId(),cuar_reply_id:o._getReplyId(t)};r.post(cuar.ajaxUrl,n,function(e){if(0==e.success)return alert(e.data),void o._enableReplyItem(t);e.data.deleted&&t.slideUp(400,function(){t.remove(),0==o._getReplies().length?o._getEmptyMessage().show():o._getEmptyMessage().hide()})})}},o._disableReplyItem=function(e){e.animate({opacity:.5}),e.find(o.options.deleteButton).css("opacity",0)},o._enableReplyItem=function(){item.animate({opacity:1}),item.find(o.options.deleteButton).css("opacity",1)},o._getReplyFromAction=function(e){return e.closest(o.options.replyItem)},o._getReplyId=function(e){return e.data("reply-id")},o._getReplyTemplate=function(){return r(o.options.replyTemplateItem,o.el)},o._getAddReplyNonce=function(){return r("input[name=cuar_add_reply_nonce]",o.el).val()},o._getDeleteReplyNonce=function(){return r("input[name=cuar_delete_reply_nonce]",o.el).val()},o._getConversationId=function(){return r(o.el).data("conversation-id")},o._getEmptyMessage=function(){return r(o.options.emptyMessage,o.el)},o._getAddReplyForm=function(){return r(o.options.addReplyForm,o.el)},o._getShownWhenLoading=function(){return r(o.options.shownWhenLoading,o.el)},o._getHiddenWhenLoading=function(e){return e.find(o.options.hiddenWhenLoading)},o._isTinyMceEnabled=function(){return"tinymce"==o.richEditorType},o._isSummerNoteEnabled=function(){return"summernote"==o.richEditorType},o._getAddReplyContent=function(){return o._isTinyMceEnabled()?tinyMCE.get(o.options.tinyMceEditor).getContent():o._isSummerNoteEnabled()?r(o.options.replyContentContainer,o.el).find(".cuar-js-richeditor").summernote("code"):r(o.options.replyContentContainer,o.el).find("textarea").val()},o._getAddReplyButton=function(){return r(o.options.addButton,o.el)},o._getReplyList=function(){return r(o.options.replyList,o.el)},o._getReplies=function(){return o._getReplyList().find(o.options.replyItem)},o._getErrorList=function(){return r(o.options.errorList,o.el)},o.init()},r.cuar.conversationManager.defaultOptions={userIsConversationAuthor:!1,replyList:".cuar-js-reply-list",replyItem:".cuar-js-reply",replyContentContainer:".cuar-js-reply-content",addButton:".cuar-js-add-action",errorList:".cuar-js-manager-errors",errorItemContent:".cuar-js-error-content",errorDismissClasses:"fa fa-times-circle",tinyMceEditor:"cuarme_reply_content",shownWhenLoading:".cuar-js-shown-when-loading",hiddenWhenLoading:".cuar-js-hidden-when-loading",addReplyForm:".cuar-js-add-reply-form",replyTemplateItem:".cuar-js-reply-template",replyContent:".cuar-js-content",replyTimestamp:".cuar-js-timestamp",replyAuthorName:".cuar-js-author",replyAvatarUrl:".cuar-js-avatar",hideWhenAuthor:".cuar-js-hide-when-author",showWhenAuthor:".cuar-js-show-when-author",emptyMessage:".cuar-js-empty-message",deleteButton:".cuar-js-delete-action"},r.fn.conversationManager=function(e){return this.each(function(){new r.cuar.conversationManager(this,e)})}}(jQuery);
//# sourceMappingURL=customer-area-conversations.js.map